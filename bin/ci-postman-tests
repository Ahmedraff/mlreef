#!/bin/sh
# change to the repository root folder via the scripts location
cd "$(dirname "$0")"/..
. bin/includes/detect-os
. bin/includes/ci-environment
########################################
set -x    # output all commands
set -e    # exit on immediately on every error
set -u    # error on usage of undefined variables
########################################


export NEWMAN_ENV_TEMPLATE="${NEWMAN_ENV:-bin/resources/newman-smoke-test-environment.json}"
export NEWMAN_ENV="$NEWMAN_ENV_TEMPLATE.pipeline"

# replace base url in postman environment file
cp "$NEWMAN_ENV_TEMPLATE" "$NEWMAN_ENV"
sed -i "s/mlreef.com/$URL/" "$NEWMAN_ENV"
cat "$NEWMAN_ENV"
newman run bin/resources/smoke-tests.postman_collection.json --environment "$NEWMAN_ENV"

# Cleanup
if [ -e "$NEWMAN_ENV" ]; then rm "$NEWMAN_ENV"; fi
